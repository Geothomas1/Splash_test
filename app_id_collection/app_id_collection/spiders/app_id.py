import scrapy
from scrapy.http.request import Request
from ..items import AppIdCollectionItem
from scrapy_splash import SplashRequest
main_list=[]

script = """
                        function main(splash,args)
                            splash:set_viewport_size(1028, 10000)
                            splash:go(args.url)
                            local scroll_to = splash:jsfunc("window.scrollTo")
                            scroll_to(0, 2900)
                            splash:wait(8)
                            return {
                                html = splash:html()
                            }
                        end
                    """
tag=['7728983614614237990', '8557464088177119809', '9222551050902695681', '4878411577482248767', '7341694200753195688', '5479458152774449252', '6379260832140845357', '9022373757469446353', '6660669299832938042', '5722004722248590599', '7198528209839843629', '6787900573040655815', '5228280937400846726', '7974375682306095917', '7424034252342455282', '5323492374096552884', '7912247255145724340', '5967736123555163199', '4626730737597491917', '6533962975553394366', '9086834178562388943', '9019378719257280280', '8669027239641171656', '6410550668166946913', '6544097133999672397', '6033416179540591490', '7836125041015115512', '4645457322784288936', '5801333510719199969', '5583065721041584973', '7748882896084752769', '7976862905843218760', '6686049340887547489', '7512232976534204692', '8605935397608621225', '6349755632898741316', '8827328271482183120', '8865508113909720731', '6940080566411724612', '7762845321682112954', '5029725802241996209', '8994816251634387692', '5350881224303297233', '5109710309067260714', '6612154865497606836', '8784124228561333652', '9194015177606812403', '6647689900282481020', '7280662926838483735', '5500268922027768394', '8328951329003015533', '7561273810435227687', '4641433510066870288', '8107455765048383987', '6338354065314080281', '7617105513155758668', '4796904331176749779', '8320687421682918713', '6426130290692546507', '4705965923598722272', '8249885696727151381', '8535927861884419281', '6777293877400254589', '8358673423940299081', '7459718057515504629', '7790819888404749522', '7305910100009209529', '7755304196688575525', '8303863465453785191', '5092329760092992392', '4733553145202573318', '8751874789538254700', '5294639457873420185', '4788638726995464232', '5213218668254069221', '8122642130540842938', '6010264469373264278', '6574068189501416290', '5469724426302426119', '4737038016995379477', '6864009721148572420', '6729412154794094237', '7528642552836646633', '7048244962463409476', '9080371205220331041', '7515169823893562689', '5481344678685740265', '8321212273852535480', '8414589764405102636', '7058593917292214574', '8697621816305908791', '5933826515267399043', '8491010175919711513', '7837434756556961310', '5393158977259622269', '7413118761911154055', '8822249440984042069', '5403508604892091981', '5264918671260285902', '8999952960853938956', '5636000515673710928', '5755858256981392149', '7627754877944270529', '7423484006267934328', '7692630605108412031', '8403819727784493059', '7483247023247894562', '7030987422025959268', '6601987249694590792', '7738075971108428585', '7173279967920589191', '8832463255938564441', '8685926049980900019', '6152680311272602832', '7918410014894544146', '8746464169672686682', '5205446584987444850', '6348959465075197331', '5647852067091551627', '4926039623319821211', '8526984088303819460', '6382246730679168845', '7150175539099361022', '6721613664904479076', '8582539129356484615', '4773945647139550410', '5771726789664282911', '7898762224136242772', '4824213305521993385', '4811272578524812196', '9087329654876482920', '5213457309378664080']
url=['https://play.google.com/store/apps/dev?id='+i
for i in tag]

class AppidSpider(scrapy.Spider):
    name='app_id'
    allowed_domain=["play.google.com"]

    def start_requests(self):
        for u in url:
            yield SplashRequest(url=u, callback=self.parse)            

    def parse(self,response):
        app_id_list=[]
        app_id=response.css('.b8cIId.ReQCgd.Q9MA7b a::attr(href)').extract() 
        for link in app_id:
            app_id_list.append(link.split('=')[-1])
        for x in app_id_list:
            main_list.append(x)
        #print(main_list)
        temp_list = []
        for i in main_list:
            if i not in temp_list:
                temp_list.append(i)
        print(len(temp_list))
        print(temp_list)
        more=response.css('div.W9yFB a::attr(href)').get()
        if more is not None:
            more=response.urljoin(more) 
            yield SplashRequest(more, self.parse,  endpoint='execute', args={'lua_source': script, 'url': more})   
            



