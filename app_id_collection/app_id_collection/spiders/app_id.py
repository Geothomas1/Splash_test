import scrapy
from scrapy.http.request import Request
from ..items import AppIdCollectionItem
from scrapy_splash import SplashRequest
main_list=[]

script = """
                        function main(splash,args)
                            splash:set_viewport_size(1028, 10000)
                            splash:go(args.url)
                            local scroll_to = splash:jsfunc("window.scrollTo")
                            scroll_to(0, 2900)
                            splash:wait(8)
                            return {
                                html = splash:html()
                            }
                        end
                    """
tag=['8708696147061348316', '7189875257499904950', '5434981919455864288', '8086911076066859876', '7805314370315145562', '5280652032028543024', '4677921281890633352', '8944177638272707933', '9096671335236347286', '6323615288256128777', '9079537017218530062', '5431035605487416523', '8131546461986106240', '7703138352091819379', '5879425033567810030', '5656868132227574971', '8866867639668567530', '7949826841308453698', '6295003604607212191', '7784723772175393887', '7465153716903802716', '4826279211274824215', '7415335330373355244', '8981100865138361762', '6884496301143992641', '8361587212244775086', '5511890662307783041', '5714179453210178056', '6452093047920166074', '5752415003483235358', '5528036608988807711', '5696525692488092768', '8536862130770836189', '5658288292299508469', '8408572091971901736', '7837073795093848924', '6686684092097678058', '7238411430284758635', '5900904566967299702', '4831436183346195213', '6792786035457492360', '5863904697164729473', '6423266045362575701', '6278614011124575486', '8424306722538135404', '8007913431381035997', '5432378785227967377', '7992963706163575780', '7061467661213961857', '8591662142386867496', '8129699754906491258', '5162292420764567672', '9031358010900352978', '4821369244680905458', '8777131724569227206', '7091159021830398545', '4650818865043857631', '7323255067831518173', '7762059515051912810', '8375269768332304042', '5076134833026608551', '9082966488677640197', '6391049555372774878', '9062900590214079790', '6174879547158582816', '9150576055844166986', '8453755841503262691', '5187430147431084320', '8875537121199785181', '7431693857951287543', '7808943377927644180', '7989667495882104914', '5810867994843996578', '4946364898076253938', '8294007952893859735', '9133839059669565336', '6711294755205279404', '8131318750154981874', '8300403323798866206', '8278122006415151139', '6054360616946340605', '6312145932602506463', '4749643075256812226', '7360977695312182713']
url=['https://play.google.com/store/apps/dev?id='+i
for i in tag]

class AppidSpider(scrapy.Spider):
    name='app_id'
    allowed_domain=["play.google.com"]

    def start_requests(self):
        for u in url:
            yield SplashRequest(url=u, callback=self.parse)            

    def parse(self,response):
        app_id_list=[]
        app_id=response.css('.b8cIId.ReQCgd.Q9MA7b a::attr(href)').extract() 
        for link in app_id:
            app_id_list.append(link.split('=')[-1])
        for x in app_id_list:
            main_list.append(x)
        #print(main_list)
        temp_list = []
        for i in main_list:
            if i not in temp_list:
                temp_list.append(i)
        print(len(temp_list))
        print(temp_list)
        more=response.css('div.W9yFB a::attr(href)').get()
        if more is not None:
            more=response.urljoin(more) 
            yield SplashRequest(more, self.parse,  endpoint='execute', args={'lua_source': script, 'url': more})   
            



