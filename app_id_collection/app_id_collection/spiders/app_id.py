import scrapy
from scrapy.http.request import Request
from ..items import AppIdCollectionItem
from scrapy_splash import SplashRequest
main_list=[]

script = """
                        function main(splash,args)
                            splash:set_viewport_size(1028, 10000)
                            splash:go(args.url)
                            local scroll_to = splash:jsfunc("window.scrollTo")
                            scroll_to(0, 2900)
                            splash:wait(8)
                            return {
                                html = splash:html()
                            }
                        end
                    """
tag=['7767018912500358450', '6015518715577716702', '5098243214971066848', '5256822617833439352', '7869842758989525920', '6315168488689689364', '7569990980868804180', '6668937984662098140', '9084578694059368445', '7805343957761321691', '7292970096811196534', '8299659031516148265', '7273392298171656591', '8738683078099370861', '7988985179258700656', '5077889280570332038', '7767184822845969254', '5617444163492552389', '7692835931263839827', '6284160494308169685', '7811132908439056405', '8709924520757064172', '5232257157456665287', '6732452454275271698', '8675899325029954651', '8270802586951014253', '5222928860075245707', '5663981342130745182', '5120691744698264028', '8291982541313931256', '8986147007762573418', '8767455634815213020', '7987494108388037675', '8981410156737117626', '8418066126729314603', '5918658556710485325', '4946270808607178069', '8487442744460578382', '8577558281498808594', '8695082207832337454', '5734641350458330590', '8382340851947772398', '7361803231715314728', '7436800604899721437', '9133341205013860773', '6141793122640931966', '6984784731579653812', '9181764175084479821', '7942910825692780718', '9057714719464407996', '5755800639503332551', '7570399753720435881', '7646941549010547895', '8745248261671253994', '6614685995890456247', '7350083905257408828', '4651967284422276629', '9078017421530989610', '8977219027276695575', '8998297479731522144', '4917590013171441453', '4969258376295639160', '5454183558804734598', '8044838679087618191', '7623907309800496426', '6910362170196959605', '4760593313960465199', '6236126543812360251', '6145504292873747826', '9110751467369412489', '4975991237380870845', '4831935318260235550', '7338295694339965615', '8182103694795071409', '7156913730869886547', '8898441436489244922', '8172717267011157100', '7040781170145785391', '5608008400672115508', '6471702037760081426', '8815266571161032386', '8947171863547214450', '4984303325256769099', '4984875986443721303']
url=['https://play.google.com/store/apps/dev?id='+i
for i in tag]

class AppidSpider(scrapy.Spider):
    name='app_id'
    allowed_domain=["play.google.com"]

    def start_requests(self):
        for u in url:
            yield SplashRequest(url=u, callback=self.parse)            

    def parse(self,response):
        app_id_list=[]
        app_id=response.css('.b8cIId.ReQCgd.Q9MA7b a::attr(href)').extract() 
        for link in app_id:
            app_id_list.append(link.split('=')[-1])
        for x in app_id_list:
            main_list.append(x)
        #print(main_list)
        temp_list = []
        for i in main_list:
            if i not in temp_list:
                temp_list.append(i)
        print(len(temp_list))
        print(temp_list)
        more=response.css('div.W9yFB a::attr(href)').get()
        if more is not None:
            more=response.urljoin(more) 
            yield SplashRequest(more, self.parse,  endpoint='execute', args={'lua_source': script, 'url': more})   
            



